# Carte BMW iX3 optimis√©e pour BMW CarData HA
# N√©cessite : card-mod + mushroom (HACS)

type: vertical-stack
cards:
  # En-t√™te avec statut
  - type: custom:mushroom-template-card
    primary: BMW iX3 (CarData)
    secondary: |
      {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
        ‚ö° En charge - {{ states('sensor.bmw_ix3_battery_level') }}%
      {% elif is_state('sensor.bmw_ix3_charging_status', 'COMPLETE') %}
        ‚úÖ Charg√©e - {{ states('sensor.bmw_ix3_battery_level') }}%
      {% else %}
        üîå Pr√™te - {{ states('sensor.bmw_ix3_battery_level') }}%
      {% endif %}
    icon: mdi:car-electric
    icon_color: |
      {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
        green
      {% elif is_state('sensor.bmw_ix3_charging_status', 'COMPLETE') %}
        blue
      {% else %}
        grey
      {% endif %}
    layout: horizontal
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
            animation: pulse 2s ease-in-out infinite;
          {% endif %}
        }
        @keyframes pulse {
          0%, 100% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.5); }
          50% { box-shadow: 0 0 20px rgba(76, 175, 80, 1); }
        }
  
  # Informations principales BMW CarData
  - type: custom:mushroom-chips-card
    chips:
      - type: template
        icon: mdi:battery
        content: '{{ states("sensor.bmw_ix3_battery_level") }}%'
        icon_color: |
          {% set level = states('sensor.bmw_ix3_battery_level') | int %}
          {% if level >= 80 %}green
          {% elif level >= 50 %}orange
          {% else %}red
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.bmw_ix3_battery_level
      - type: template
        icon: mdi:map-marker-distance
        content: '{{ states("sensor.bmw_ix3_range_electric") }} km'
        icon_color: blue
        tap_action:
          action: more-info
          entity: sensor.bmw_ix3_range_electric
      - type: template
        icon: |
          {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
            mdi:battery-charging
          {% else %}
            mdi:power-plug-off
          {% endif %}
        content: |
          {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
            {{ states("sensor.bmw_ix3_charging_power") }} kW
          {% else %}
            Non branch√©e
          {% endif %}
        icon_color: |
          {% if is_state('sensor.bmw_ix3_charging_status', 'CHARGING') %}
            green
          {% else %}
            grey
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.bmw_ix3_charging_status
    alignment: center
    card_mod:
      style: |
        ha-card {
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          border-radius: 15px;
        }
  
  # Barre de progression batterie
  - type: custom:mushroom-progress-card
    entity: sensor.bmw_ix3_battery_level
    name: Niveau de batterie
    icon: mdi:battery
    card_mod:
      style: |
        ha-card {
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          border-radius: 15px;
        }
  
  # Informations d√©taill√©es BMW CarData
  - type: markdown
    content: |
      ## üìä Informations BMW CarData
      
      ### üîã Batterie
      - **SOC Actuel** : {{ states('sensor.bmw_ix3_battery_level') }}%
      - **SOC Pr√©dit (BMW)** : {{ states('sensor.bmw_ix3_state_of_charge_predicted_bmw_side') or 'N/A' }}%
      - **SOC Pr√©dit (Int√©gration)** : {{ states('sensor.bmw_ix3_state_of_charge_predicted_integration_side') or 'N/A' }}%
      - **SOC Cible** : {{ states('sensor.bmw_ix3_target_state_of_charge') or 'N/A' }}%
      
      ### ‚ö° Charge
      - **√âtat** : {{ states('sensor.bmw_ix3_charging_status') or 'N/A' }}
      - **M√©thode** : {{ states('sensor.bmw_ix3_charging_method') or 'N/A' }}
      - **Phases** : {{ states('sensor.bmw_ix3_charging_phases') or 'N/A' }}
      - **Temps restant** : {{ states('sensor.bmw_ix3_charging_time_remaining') or 'N/A' }}
      - **Vitesse pr√©dite** : {{ states('sensor.bmw_ix3_predicted_charge_speed') or 'N/A' }} kW
      
      ### üîã Batterie HV
      - **Taille** : {{ states('sensor.bmw_ix3_high_voltage_battery_size') or 'N/A' }} kWh
      - **Contenu √©nerg√©tique** : {{ states('sensor.bmw_ix3_energy_content_high_voltage_battery') or 'N/A' }} kWh
      
      ### üõ£Ô∏è Autonomie
      - **Autonomie √©lectrique** : {{ states('sensor.bmw_ix3_range_electric') }} km
      - **Autonomie en charge** : {{ states('sensor.bmw_ix3_forecast_electric_range_during_charging') or 'N/A' }} km
      
      ### üîß Syst√®me
      - **Mode veille profonde** : {{ states('sensor.bmw_ix3_deep_sleep_mode') or 'N/A' }}
      - **Consommation auxiliaire** : {{ states('sensor.bmw_ix3_auxiliary_power_consumption_electrical_components') or 'N/A' }} W
      
      ---
      
      üí° **Note** : Les valeurs "N/A" indiquent que l'entit√© n'est pas encore d√©tect√©e par le plugin.
    card_mod:
      style: |
        ha-card {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(10px);
          border-radius: 15px;
        }
        ha-markdown {
          padding: 16px;
        }
        h3 {
          color: #4CAF50;
          margin-top: 20px;
          margin-bottom: 10px;
        }
        h2 {
          color: #2196F3;
          margin-top: 30px;
          margin-bottom: 15px;
        }
  
  # Contr√¥les du plugin
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-template-card
        entity: switch.bmw_ix3_auto_stop_80_percent
        icon: mdi:battery-80
        icon_color: |
          {% if is_state('switch.bmw_ix3_auto_stop_80_percent', 'on') %}
            green
          {% else %}
            grey
          {% endif %}
        primary: Auto 80%
        tap_action:
          action: toggle
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.1);
              backdrop-filter: blur(10px);
            }
      - type: custom:mushroom-template-card
        entity: number.bmw_ix3_target_soc
        icon: mdi:battery-charging
        icon_color: orange
        primary: SOC {{ states('number.bmw_ix3_target_soc') }}%
        tap_action:
          action: more-info
          entity: number.bmw_ix3_target_soc
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.1);
              backdrop-filter: blur(10px);
            }

# Style g√©n√©ral
card_mod:
  style: |
    ha-card {
      gap: 10px;
    }

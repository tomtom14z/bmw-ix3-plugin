# Carte BMW iX3 avec VRAIS Contr√¥les Interactifs
# N√©cessite : card-mod + mushroom (HACS)

type: vertical-stack
cards:
  # En-t√™te
  - type: custom:mushroom-template-card
    primary: üéõÔ∏è Contr√¥les BMW iX3
    secondary: |
      SOC Actuel : {{ states('sensor.state_of_charge_last_known') }}% | 
      SOC Cible : {{ states('number.bmw_ix3_target_soc') or '80' }}%
    icon: mdi:car-electric
    icon_color: blue
    layout: horizontal
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
          color: white;
        }
  
  # Contr√¥les principaux
  - type: entities
    title: üéõÔ∏è R√©glages Principaux
    entities:
      - entity: number.bmw_ix3_target_soc
        name: SOC Cible
        icon: mdi:battery-charging
      - entity: number.bmw_ix3_departure_time
        name: Heure de D√©part
        icon: mdi:clock-outline
      - entity: switch.bmw_ix3_auto_stop_80_percent
        name: Arr√™t Auto √† 80%
        icon: mdi:battery-80
    card_mod:
      style: |
        ha-card {
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          border-radius: 15px;
        }
  
  # Boutons d'action rapide
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: SOC 80%
        icon: mdi:battery-80
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_target_soc
            value: 80
        styles:
          card:
            - background: rgba(76, 175, 80, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: green
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## SOC 80%
                *Recommand√©*
      - type: custom:button-card
        name: SOC 90%
        icon: mdi:battery-90
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_target_soc
            value: 90
        styles:
          card:
            - background: rgba(255, 193, 7, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: orange
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## SOC 90%
                *Long trajet*
      - type: custom:button-card
        name: SOC 100%
        icon: mdi:battery
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_target_soc
            value: 100
        styles:
          card:
            - background: rgba(244, 67, 54, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: red
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## SOC 100%
                *Voyage long*
  
  # Boutons d'heure de d√©part
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        name: D√©part 06h00
        icon: mdi:clock-fast
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_departure_time
            value: 6
        styles:
          card:
            - background: rgba(76, 175, 80, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: green
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## 06h00
                *Charge 7.4kW*
      - type: custom:button-card
        name: D√©part 08h00
        icon: mdi:clock-outline
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_departure_time
            value: 8
        styles:
          card:
            - background: rgba(33, 150, 243, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: blue
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## 08h00
                *Charge 11kW*
      - type: custom:button-card
        name: D√©part 10h00
        icon: mdi:clock-alert
        tap_action:
          action: call-service
          service: number.set_value
          service_data:
            entity_id: number.bmw_ix3_departure_time
            value: 10
        styles:
          card:
            - background: rgba(255, 193, 7, 0.1)
            - border-radius: 15px
            - color: white
          icon:
            - color: orange
        custom_fields:
          name:
            card:
              type: markdown
              content: |
                ## 10h00
                *Charge 22kW*
  
  # Tableau des temps de charge
  - type: markdown
    content: |
      ## ‚è±Ô∏è Temps de Charge (Mis √† jour automatiquement)
      
      | Puissance | 80% | 100% |
      |-----------|-----|------|
      | **7.4 kW** | {{ states('sensor.bmw_ix3_charge_time_80_7_4kw') or 'Calcul...' }} | {{ states('sensor.bmw_ix3_charge_time_100_7_4kw') or 'Calcul...' }} |
      | **11 kW** | {{ states('sensor.bmw_ix3_charge_time_80_11kw') or 'Calcul...' }} | {{ states('sensor.bmw_ix3_charge_time_100_11kw') or 'Calcul...' }} |
      | **22 kW** | {{ states('sensor.bmw_ix3_charge_time_80_22kw') or 'Calcul...' }} | {{ states('sensor.bmw_ix3_charge_time_100_22kw') or 'Calcul...' }} |
      
      ---
      
      ### üìä Configuration Actuelle
      - **SOC Cible** : {{ states('number.bmw_ix3_target_soc') or '80' }}%
      - **Heure de D√©part** : {{ states('number.bmw_ix3_departure_time') or '08:00' }}h
      - **Arr√™t Auto 80%** : {{ '‚úÖ Activ√©' if is_state('switch.bmw_ix3_auto_stop_80_percent', 'on') else '‚ùå D√©sactiv√©' }}
    card_mod:
      style: |
        ha-card {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(10px);
          border-radius: 15px;
        }
        ha-markdown {
          padding: 20px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin: 20px 0;
        }
        th, td {
          padding: 12px;
          text-align: center;
          border: 1px solid rgba(255,255,255,0.2);
        }
        th {
          font-weight: bold;
          background: rgba(33, 150, 243, 0.3);
          color: white;
        }
        td {
          background: rgba(255, 255, 255, 0.1);
          color: white;
        }
        h2 {
          color: #2196F3;
          margin-top: 0;
        }
        h3 {
          color: #4CAF50;
          margin-top: 25px;
        }

# Style g√©n√©ral
card_mod:
  style: |
    ha-card {
      gap: 10px;
    }

